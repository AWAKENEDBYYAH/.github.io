<!-- stream.html (Fan Streaming Sanctuary for AWAKENED BY YAH)
     - Protected: requires aby_stream_session from login.html
     - Redirects to /login.html if not logged in
     - Safe: does not disturb the rest of your site
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>STREAM | AWAKENED BY YAH</title>

  <link rel="icon" type="image/png" href="/abytransparent.png">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/favicon.png">
  <link rel="canonical" href="https://awakenedbyyahmusic.com/stream.html" />

  <style>
    :root{
      --bg:#020617;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --line:rgba(255,255,255,.10);
      --brand:#1C39A8;
      --brand2:#2b56ff;
      --glow:rgba(28,57,168,.45);
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.03);
      --radius:22px;
      --shadow: 0 18px 55px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 15%, rgba(43,86,255,.20), transparent 55%),
        radial-gradient(900px 500px at 85% 20%, rgba(28,57,168,.22), transparent 55%),
        radial-gradient(1200px 700px at 50% 100%, rgba(255,255,255,.06), transparent 60%),
        var(--bg);
    }

    .top{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(2,6,23,.88), rgba(2,6,23,.55));
      border-bottom:1px solid var(--line);
    }
    .top-inner{
      max-width:1200px; margin:0 auto;
      padding:14px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      text-decoration:none; color:var(--text);
    }
    .logo{
      width:36px;height:36px;border-radius:12px;
      border:1px solid var(--line);
      box-shadow: 0 0 22px var(--glow);
      overflow:hidden;
      background: radial-gradient(circle at 30% 30%, rgba(43,86,255,.55), rgba(28,57,168,.12));
      display:grid; place-items:center;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .brand-title{display:flex; flex-direction:column; line-height:1.1}
    .brand-title strong{letter-spacing:.06em}
    .brand-title span{font-size:12px;color:var(--muted)}

    .top-actions{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      text-decoration:none;
      cursor:pointer;
      transition:.2s transform, .2s background, .2s border-color;
      font-weight:650;
      letter-spacing:.02em;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.06); border-color:rgba(255,255,255,.18)}
    .btn.primary{
      border-color:rgba(43,86,255,.45);
      background: linear-gradient(135deg, rgba(28,57,168,.55), rgba(43,86,255,.22));
      box-shadow: 0 0 28px rgba(43,86,255,.18);
    }
    .btn.primary:hover{border-color:rgba(43,86,255,.65);}
    .btn.danger{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.10);
    }

    .wrap{
      max-width:1200px; margin:0 auto;
      padding:26px 18px 70px;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:18px;
      align-items:start;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr; padding-top:16px;}
    }

    .panel{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .hero{
      padding:22px;
      position:relative;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(650px 240px at 20% 10%, rgba(43,86,255,.22), transparent 60%),
                  radial-gradient(650px 240px at 80% 20%, rgba(28,57,168,.22), transparent 60%);
      pointer-events:none;
    }
    .hero > *{position:relative}
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid rgba(43,86,255,.28);
      background: rgba(28,57,168,.18);
      color: var(--text);
      font-weight:800;
      letter-spacing:.06em;
      font-size:12px;
      margin-bottom:10px;
    }
    h1{
      margin:0 0 6px;
      font-size: clamp(24px, 3.3vw, 40px);
      letter-spacing:.05em;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:14px;
      line-height:1.4;
      max-width:70ch;
    }

    .grid{
      padding:18px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(2, 1fr);}
    }
    @media (max-width: 520px){
      .grid{grid-template-columns: 1fr;}
    }

    .album{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      overflow:hidden;
      cursor:pointer;
      transition: .2s transform, .2s border-color, .2s background;
      display:flex; flex-direction:column;
      min-height: 180px;
    }
    .album:hover{
      transform: translateY(-2px);
      border-color: rgba(43,86,255,.35);
      background: rgba(255,255,255,.045);
    }
    .cover{
      aspect-ratio: 1 / 1;
      width:100%;
      display:grid; place-items:center;
      border-bottom: 1px solid var(--line);
      position:relative;
      background:
        radial-gradient(circle at 25% 25%, rgba(43,86,255,.28), transparent 55%),
        radial-gradient(circle at 75% 20%, rgba(28,57,168,.22), transparent 55%),
        rgba(255,255,255,.02);
    }
    .cover img{
      width:100%; height:100%;
      object-fit:cover; display:block;
    }
    .badge{
      position:absolute; top:10px; left:10px;
      padding:7px 10px;
      border-radius: 999px;
      border:1px solid rgba(43,86,255,.35);
      background: rgba(28,57,168,.18);
      font-size:11px;
      font-weight:900;
      letter-spacing:.06em;
    }
    .meta{
      padding:12px 12px 14px;
      display:flex; flex-direction:column; gap:6px;
    }
    .meta strong{letter-spacing:.04em}
    .meta span{color:var(--muted); font-size:12px}

    .player{
      padding:18px;
      position:sticky;
      top:76px;
    }
    @media (max-width: 980px){
      .player{position:relative; top:auto;}
    }
    .player h2{
      margin:0 0 6px;
      letter-spacing:.06em;
      font-size:16px;
    }
    .player .now{
      color:var(--muted);
      font-size:13px;
      margin:0 0 14px;
      line-height:1.35;
    }

    .tracklist{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      max-height: 360px;
      overflow:auto;
      padding-right: 4px;
    }
    .track{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding:10px 10px;
      cursor:pointer;
      display:flex;
      gap:10px;
      align-items:flex-start;
      transition:.2s transform,.2s background,.2s border-color;
    }
    .track:hover{
      transform:translateY(-1px);
      background: rgba(255,255,255,.045);
      border-color: rgba(43,86,255,.28);
    }
    .track .n{
      width:24px; height:24px; border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      display:grid; place-items:center;
      font-size:12px; color:var(--muted);
      flex:0 0 auto;
    }
    .track .tmeta{flex:1}
    .track .tmeta strong{display:block; font-size:13px; letter-spacing:.03em}
    .track .tmeta span{display:block; font-size:12px; color:var(--muted); margin-top:3px}
    .track.active{
      border-color: rgba(43,86,255,.55);
      box-shadow: 0 0 0 4px rgba(43,86,255,.10);
      background: rgba(28,57,168,.10);
    }

    audio{width:100%; margin-top:10px; border-radius: 14px; outline:none;}

    .controls{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    .mini{
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      font-weight:750;
      letter-spacing:.02em;
      transition:.2s transform,.2s background,.2s border-color;
      display:inline-flex; align-items:center; gap:8px;
    }
    .mini:hover{transform:translateY(-1px); background:rgba(255,255,255,.06); border-color:rgba(255,255,255,.18)}
    .mini.primary{
      border-color:rgba(43,86,255,.45);
      background: linear-gradient(135deg, rgba(28,57,168,.50), rgba(43,86,255,.18));
    }
    .mini.on{border-color: rgba(43,86,255,.65); box-shadow: 0 0 0 4px rgba(43,86,255,.10);}

    .fine{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding:12px;
    }

    footer{
      max-width:1200px; margin:0 auto;
      padding:0 18px 26px;
      color:var(--muted);
      font-size:12px;
      opacity:.9;
    }
    .tracklist::-webkit-scrollbar{width:10px}
    .tracklist::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:10px}
    .tracklist::-webkit-scrollbar-track{background:transparent}
  </style>
</head>

<body>
  <div class="top">
    <div class="top-inner">
      <a class="brand" href="/">
        <div class="logo" aria-hidden="true">
          <img src="/abytransparent.png" alt="">
        </div>
        <div class="brand-title">
          <strong>AWAKENED BY YAH</strong>
          <span>STREAM (FAN ACCESS)</span>
        </div>
      </a>

      <div class="top-actions">
        <a class="btn" href="/music.html">MUSIC</a>
        <a class="btn" href="/login.html" title="Go to login page">ACCOUNT</a>
        <button class="btn danger" id="logoutBtn" type="button">LOG OUT</button>
      </div>
    </div>
  </div>

  <main class="wrap">
    <section class="panel">
      <div class="hero">
        <div class="tag">üîí FAN ACCESS ‚Ä¢ FULL STREAMING</div>
        <h1 id="welcome">Welcome.</h1>
        <p class="sub">
          You are inside the listening sanctuary of <strong>AWAKENED BY YAH</strong>.
          Stream full-length music, hear early releases first, and support the sound directly‚Äîad-free and distraction-free.
        </p>
      </div>

      <div class="grid" id="albumGrid"></div>
    </section>

    <aside class="panel player">
      <h2>NOW STREAMING</h2>
      <p class="now" id="nowText">Select an album to begin.</p>

      <audio id="audio" controls preload="metadata"></audio>

      <div class="controls">
        <button class="mini" id="prevBtn" type="button">‚èÆÔ∏è Prev</button>
        <button class="mini primary" id="playBtn" type="button">‚ñ∂Ô∏è Play</button>
        <button class="mini" id="nextBtn" type="button">‚è≠Ô∏è Next</button>
        <button class="mini" id="repeat1Btn" type="button" title="Repeat current track">üîÇ Repeat 1</button>
        <button class="mini" id="repeatAllBtn" type="button" title="Repeat all tracks">üîÅ Repeat All</button>
      </div>

      <div class="tracklist" id="tracklist"></div>

      <div class="fine">
        <strong>Note:</strong> This is a protected fan page. If someone is not logged in, they will be redirected to
        <code>/login.html</code>.
      </div>
    </aside>
  </main>

  <footer>
    ¬© <span id="yr"></span> <strong>AWAKENED BY YAH</strong>. All Rights Reserved.
  </footer>

  <script>
    // ====== AUTH GUARD ======
    const SESSION_KEY = "aby_stream_session";
    function getSession() {
      const a = localStorage.getItem(SESSION_KEY);
      const b = sessionStorage.getItem(SESSION_KEY);
      try { return JSON.parse(a || b || "null"); } catch { return null; }
    }
    const session = getSession();
    if (!session || !session.email) window.location.replace("/login.html");

    const $ = (id) => document.getElementById(id);
    $("yr").textContent = new Date().getFullYear();

    const email = (session?.email || "").toString();
    const role = (session?.role || "").toString();
    const displayName = email ? email.split("@")[0] : "Supporter";
    $("welcome").textContent = `Welcome, ${displayName}${role ? " (" + role + ")" : ""}.`;

    $("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem(SESSION_KEY);
      sessionStorage.removeItem(SESSION_KEY);
      window.location.href = "/login.html";
    });

    function escapeHTML(str) {
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // Handles spaces + apostrophes safely by encoding each URL segment
    function safeSrc(path) {
      try {
        return path.split("/").map((seg, i) => (i === 0 ? seg : encodeURIComponent(seg))).join("/");
      } catch {
        return encodeURI(path);
      }
    }

    // ====== TRACK LISTS (MATCH YOUR UPLOADED NAMES) ======
    const kingdomBizTracks = [
      { title: "Walk It Out", subtitle: "KINGDOM BIZ", src: "/audio/TRACK 01_WALK IT OUT.mp3" },
      { title: "Rise of the Remnant", subtitle: "KINGDOM BIZ", src: "/audio/TRACK 02_RISE OF THE REMNANT.mp3" },
      { title: "We Rise", subtitle: "KINGDOM BIZ", src: "/audio/TRACK 03__WE RISE.mp3" },
      { title: "Unbroken Frequency", subtitle: "KINGDOM BIZ", src: "/audio/TRACK 04_UNBROKEN FREQUENCY.mp3" },
      { title: "Unbroken Frequency (Remix)", subtitle: "KINGDOM BIZ", src: "/audio/TRACK 05__UNBROKEN FREQUENCY REMIX.mp3" }
    ];

    const riseOfYasharalTracks = [
      { title: "The Love I Have in YAHUAH", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 01_THE LOVE I HAVE IN YAHUAH.mp3" },
      { title: "You're With Me", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 02_YOU'RE WITH ME.mp3" },
      { title: "Beneath Your Wings", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 03_BENEATH YOUR WINGS.mp3" },
      { title: "YAHUAH the Holy One of Yasharal", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 04_YAHUAH THE HOLY ONE OF YASHARAL.mp3" },
      { title: "Show Me Your Heart", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 05_SHOW ME YOUR HEART.mp3" },
      { title: "YAH'S Chosen (The Great Gathering)", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 06_YAHS CHOSEN THE GREAT GATHERING.mp3" },
      { title: "YAHUAH Is the Father's Name", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 07_YAHUAH IS THE FATHERS NAME.mp3" },
      { title: "How Sweet Is Your Name YAHUAH", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 08_HOW SWEET IS YOUR NAME YAHUAH.mp3" },
      { title: "In Your Presence", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 09_IN YOUR PRESENCE.mp3" },
      { title: "Halal YAHUAH (We Magnify Your Name)", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 10_HALAL YAHUAH WE MAGNIFY YOUR NAME.mp3" },
      { title: "Awakened by YAH", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 11_AWAKENED BY YAH.mp3" },
      { title: "Return to the Covenant", subtitle: "THE RISE OF YASHARAL", src: "/audio/ROY_TRACK 12_RETURN TO THE COVENANT.mp3" }
    ];

    // ====== COVERS ======
    const COVER_FAN = "/images/abym-cover.png?v=3";
    const COVER_ROY = "/images/rise-of-yasharal.png?v=3";
    const COVER_KB  = "/images/kingdom-biz.png?v=3";

    // ====== LIBRARY ======
    const library = [
      {
        id: "fan-exclusives",
        title: "FAN EXCLUSIVES",
        subtitle: "Supporter Vault ‚Ä¢ Bonus Access",
        badge: "EXCLUSIVE",
        cover: COVER_FAN,
        tracks: [
          { title: "Hear My Voice", subtitle: "Fan Exclusive", src: "/audio/ABY_TRACK 01_HEAR MY VOICE.mp3" },
          { title: "Deliver Us", subtitle: "Fan Exclusive", src: "/audio/ABYM_TRACK 01_DELIVER US.mp3" }
        ]
      },
      {
        id: "rise-of-yasharal",
        title: "THE RISE OF YASHARAL",
        subtitle: "Full Album ‚Ä¢ Fan Streaming",
        badge: "FULL ALBUM",
        cover: COVER_ROY,
        tracks: riseOfYasharalTracks
      },
      {
        id: "kingdom-biz",
        title: "KINGDOM BIZ: RISE OF THE REMNANT",
        subtitle: "Full Album ‚Ä¢ Fan Streaming",
        badge: "FULL ALBUM",
        cover: COVER_KB,
        tracks: kingdomBizTracks
      }
    ];

    // ====== RENDER ALBUM GRID ======
    const albumGrid = $("albumGrid");
    const FALLBACK_COVER = COVER_FAN;

    function albumCardHTML(a){
      const safeTitle = escapeHTML(a.title);
      const safeSub = escapeHTML(a.subtitle || "");
      const safeBadge = escapeHTML(a.badge || "");
      const cover = a.cover || FALLBACK_COVER;

      return `
        <div class="album" data-album="${a.id}" role="button" tabindex="0" aria-label="Open album ${safeTitle}">
          <div class="cover">
            ${safeBadge ? `<div class="badge">${safeBadge}</div>` : ""}
            <img
              src="${cover}"
              alt="${safeTitle} cover"
              loading="lazy"
              onerror="this.onerror=null; this.src='${FALLBACK_COVER}';"
            >
          </div>
          <div class="meta">
            <strong>${safeTitle}</strong>
            <span>${safeSub}</span>
          </div>
        </div>
      `;
    }

    albumGrid.innerHTML = "";
    for (const a of library) albumGrid.insertAdjacentHTML("beforeend", albumCardHTML(a));

    // ====== PLAYER LOGIC ======
    const audio = $("audio");
    const nowText = $("nowText");
    const tracklistEl = $("tracklist");

    let currentAlbum = null;
    let currentIndex = 0;

    let repeat1 = false;
    let repeatAll = false;

    function setRepeatButtons() {
      $("repeat1Btn").classList.toggle("on", repeat1);
      $("repeatAllBtn").classList.toggle("on", repeatAll);
    }

    $("repeat1Btn").addEventListener("click", () => {
      repeat1 = !repeat1;
      if (repeat1) repeatAll = false;
      setRepeatButtons();
    });

    $("repeatAllBtn").addEventListener("click", () => {
      repeatAll = !repeatAll;
      if (repeatAll) repeat1 = false;
      setRepeatButtons();
    });

    setRepeatButtons();

    function renderTracklist(album) {
      tracklistEl.innerHTML = "";
      album.tracks.forEach((t, i) => {
        const el = document.createElement("div");
        el.className = "track";
        el.dataset.index = i;

        el.innerHTML = `
          <div class="n">${i+1}</div>
          <div class="tmeta">
            <strong>${escapeHTML(t.title)}</strong>
            <span>${escapeHTML(t.subtitle || "")}</span>
          </div>
        `;
        el.addEventListener("click", () => playTrack(i));
        tracklistEl.appendChild(el);
      });
      highlightActive();
    }

    function highlightActive() {
      [...tracklistEl.querySelectorAll(".track")].forEach((el) => {
        el.classList.toggle("active", Number(el.dataset.index) === currentIndex);
      });
    }

    function playTrack(i) {
      if (!currentAlbum) return;
      currentIndex = i;

      const t = currentAlbum.tracks[currentIndex];
      nowText.innerHTML = `<strong>${escapeHTML(currentAlbum.title)}</strong><br>${escapeHTML(t.title)}`;

      audio.src = safeSrc(t.src);
      audio.play().catch(() => {});
      $("playBtn").textContent = "‚è∏Ô∏è Pause";
      highlightActive();
    }

    function nextTrack() {
      if (!currentAlbum) return;
      if (currentIndex < currentAlbum.tracks.length - 1) playTrack(currentIndex + 1);
      else if (repeatAll) playTrack(0);
      else $("playBtn").textContent = "‚ñ∂Ô∏è Play";
    }

    function prevTrack() {
      if (!currentAlbum) return;
      if (audio.currentTime > 3) { audio.currentTime = 0; return; }
      if (currentIndex > 0) playTrack(currentIndex - 1);
      else if (repeatAll) playTrack(currentAlbum.tracks.length - 1);
      else audio.currentTime = 0;
    }

    audio.addEventListener("ended", () => {
      if (repeat1) { audio.currentTime = 0; audio.play(); return; }
      nextTrack();
    });

    $("playBtn").addEventListener("click", () => {
      if (!audio.src) { if (currentAlbum?.tracks?.length) playTrack(0); return; }
      if (audio.paused) { audio.play(); $("playBtn").textContent = "‚è∏Ô∏è Pause"; }
      else { audio.pause(); $("playBtn").textContent = "‚ñ∂Ô∏è Play"; }
    });

    $("nextBtn").addEventListener("click", nextTrack);
    $("prevBtn").addEventListener("click", prevTrack);

    albumGrid.addEventListener("click", (e) => {
      const card = e.target.closest(".album");
      if (!card) return;
      const album = library.find(a => a.id === card.dataset.album);
      if (!album) return;

      currentAlbum = album;
      currentIndex = 0;

      renderTracklist(album);
      nowText.textContent = `Album selected: ${album.title}. Choose a track.`;
      if (album.tracks?.length) audio.src = safeSrc(album.tracks[0].src);
    });

    albumGrid.addEventListener("keydown", (e) => {
      if (e.key !== "Enter") return;
      const card = e.target.closest(".album");
      if (card) card.click();
    });

    if (library.length) {
      currentAlbum = library[0];
      renderTracklist(currentAlbum);
      nowText.textContent = `Album selected: ${currentAlbum.title}. Choose a track.`;
      if (currentAlbum.tracks?.length) audio.src = safeSrc(currentAlbum.tracks[0].src);
    }
  </script>
</body>
</html>
